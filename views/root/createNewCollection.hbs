<html>

<head>

    <title>New Collection</title>

    <style type="text/css">
        
        body {
            width: 800px;
            margin: auto;
        }
        
        .propertySelect {
            display: flex;
            border: 1px solid grey;
            align-items: center;
            justify-content: center;
        }

        .propertySelect > input, .propertySelect > select {
            width: 50%;
            align-items: center;
            text-align: center;
            padding: 10px;
            border: 0px solid grey;
            
        }

        .propertySelect > label, .propertySelect > [type=radio] {
            width: 10%;
            align-items: center;
            text-align: center;
            display: flex;
            align-items: center;
        }

        form > * {
            margin-top: 1rem;
        }

        button {
            padding: 10px;
            border: 1px solid grey;
        }

        .error {
            font-weight: bold;
            color: red;
        }
    </style>
</head>

<body>

    <p class=error>{{error}}</p>

    <p>Create new Collection below</p>

    <p>Owner: {{owner}}</p>

    <p>Collection Name: {{name}}</p>

    <form action="#" method="post">
        
      <div class="propertySelect">
          <input name="label1" type="text" placeholder="Label">
          <select name="type1" id="type1">
            {{#each types}}
                <option value="{{this}}">{{this}}</option>
            {{/each}}
          </select>
          <input type="radio" id="true" name="req1" value="true">
          <label for="true">true</label>
          <input type="radio" id="false" name="req1" value="false">
          <label for="false">false</label>
      </div>

      <button type="button" id="btn-more">Add One More</button>
        <br>
      <button type="submit">Submit</button>

    </form>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <script>

        $('#btn-more').on('click',function() {
            $('.propertySelect:eq(0)').clone().insertAfter('.propertySelect:eq(-1)');
            $('.propertySelect:eq(-1)>input').attr('name','label'+$('.propertySelect').length);
            $('.propertySelect:eq(-1)>select').attr('name','type'+$('.propertySelect').length);
            $('.propertySelect:eq(-1)>[type=radio]').attr('name','req'+$('.propertySelect').length);
        });

        $('form').on('submit',function(e) {
            e.preventDefault();
            let labels = $(this).serializeArray().filter(val => /label/gi.test(val.name));
            let types = $(this).serializeArray().filter(val => /type/gi.test(val.name));
            let reqs = $(this).serializeArray().filter(val => /req/gi.test(val.name));
            let output = labels.reduce((total,val,index) => {
                return Object.assign(total,{
                    [val.value] : {
                        type: types[index].value,
                        required: reqs[index].value
                    }
                });
            },{});
            let data = {
                name: '{{name}}',
                owner: '{{owner}}',
                properties: output
            };
            $.ajax({
              type: "POST",
              url: '/root/data/saveSequence/n',
              data: data,
              success: () => console.log('successful data sent'),
            });
            return console.log(data);
            return console.log(output);
            return console.log($(this).serializeArray().filter(val => /type/gi.test(val.name)));
            console.log($(this).serialize());
            console.log('form prevented from submission');
            let properties = {
                name: {
                    type: String,
                    required: true
                },
                password: {
                    type: Object,
                    required: true,
                }
            };
        });

        // label: name, type: String

    </script>

</body>

</html>
