<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Editing Â· {{data.pageName}}</title>
<style>

body {
    padding: 0;
    margin: 0;
}

iframe {
    position: absolute;
    width: 100vw;
    height: 100vh;
    left: 0;
    top: 0;
}

.editors {
    width: 600px;
    z-index: 100;
    position: absolute;
    background: white;
    padding: 6px;
    border: 4px solid #27AE60;
}

.editors.fullScreen {
    width: 100vw;
    height: 100vh;
    box-sizing: border-box;
}

.editors.fullScreen > #editor {
    width: 76vw;
    height: 89vh;
    box-sizing: border-box;
}

.editors > * {
    width: 100%;
    box-sizing: border-box;
    border: 0px;
}

.editors > p {
    font-size: 14px;
    font-weight: bold;
    padding: 8px 10px;
    background: white;
    position: relative;
    display: inline-block;
    width: initial;
    border-radius: 5px;
    font-family: system-ui;
    color: lightseagreen;
    line-height: 1.5;
    margin-top: 0px;
}

.editors > textarea {
    background: whitesmoke;
    border-radius: 5px;
    padding: 10px;
    font-family: monospace;
}

.editors > .top-bar {
    display: flex;
    align-items: center;
    line-height: 0;
    box-sizing: border-box;
    width: 100%;
}

.editors > .top-bar > input {
    flex-grow: 1;
    background: #f2f2f2;
    border: 1px solid #f2f2f2;
    padding: 4px 5px;
    box-sizing: border-box;
}

.editors > .top-bar > p {
    line-height: 0;
    padding: 0;
    margin: 0;
    margin-left: 4px;
    box-sizing: border-box;
}

.editors > #editor {
    position: relative;
    margin-top: 10px;
    margin-bottom: 8px;
    height: 500px;
    width: 600px;
}

.editors > .save-button {
    background: whitesmoke;
    border: 1px solid whitesmoke;
    padding: 8px 8px;
    font-weight: bold;
    width: fit-content;
}

.minimize {
    display: none;
}

.bottom_buttons {
    position: absolute;
    right: 10px;
    bottom: 10px;
    z-index: 100;
}

.bottom_buttons > button {
    padding: 9px;
    font-weight: bold;
    color: #333333;
}

.bottom_buttons > [block="html"] {
    border: 1px solid #6FCF97;
    background: #6FCF97;
}

.bottom_buttons > [block="css"] {
    border: 1px solid #F2994A;
    background: #F2994A;
}

.bottom_buttons > [block="js"] {
    border: 1px solid #2D9CDB;
    background: #2D9CDB;
}

</style>
</head>
<body>
    <div class="editors html" id="draggable">
        <div class="top-bar">
            <input type="text" placeholder="Search an html tag in File">
            <p onclick=minimize(this)>
                <svg width="25" height="26" viewBox="0 0 25 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="25" height="26" fill="#F2F2F2"/>
                <path d="M17.9131 13.6348H7.79834V11.9062H17.9131V13.6348Z" fill="black"/>
                </svg>
            </p>
            <p onclick=fullScreen(this)>
                <svg width="25" height="26" viewBox="0 0 25 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="25" height="26" fill="#F2F2F2"/>
                    <rect x="1" y="-1" width="10" height="10" transform="matrix(1 0 0 -1 7 17)" stroke="#333333" stroke-width="2"/>
                </svg>
            </p>
        </div>
        <div id="editor">{{data.file}}</div>
        <button class="save-button" onclick=saveFile()>Save</button>
    </div>

    {{#if data.file}}
        <iframe id="iframe" src="/{{data.brand}}/admin/page/{{data.pageName}}/{{data.manualInput}}" frameborder="0"></iframe>
    {{/if}}

    <div class="bottom_buttons">
        <button onclick=maximize(this) block="html" class="active">HTML</button>
        <button onclick=maximize(this) block="css">CSS</button>
        <button onclick=maximize(this) block="js">JS</button>
    </div>
    
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="//ajaxorg.github.io/ace-builds/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>

    <script>
    
        let fullScreen = function(elem) {
            $(elem).closest(".editors").toggleClass('fullScreen');
            startEditor();
            $( "#draggable" ).draggable();
            console.log('toggled screen bro');
        }

        let minimize = function(elem) {
            $(elem).closest(".editors").addClass('minimize');
            console.log('down bro');
        }
         
        let maximize = function(elem) {
            let className = $(elem).attr("block");
            $(`.${className}`).toggleClass('minimize');
            console.log('maximized bro');
        }

        let editor;

        let startEditor = function() {
            editor = ace.edit("editor");
            editor.getSession().setUseWorker(false);
            editor.setTheme("ace/theme/chrome");
            editor.getSession().setMode("ace/mode/html");   
            editor.renderer.setShowGutter(false);
            editor.setShowPrintMargin(false);
        }

        $( function() {
            $( "#draggable" ).draggable();
            startEditor();
          } );

        let saveFile = function() {

            let data = {
                html: editor.getSession().getValue(),
            };

            $.ajax({
                url: "/{{data.brand}}/admin/data/saveWeb/{{data.pageName}}",
                method: "POST",
                data: data,
                success: (done) => {
                 $( '#iframe' ).attr( 'src', function ( i, val ) { return val; });
                 console.log(done);
                },
            }).fail( err => console.log(err) );

        };
    

    </script>
</body>
</html>
