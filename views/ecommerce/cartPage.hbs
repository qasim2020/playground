<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cart Page</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500&display=swap" rel="stylesheet">
    <style type="text/css">
        body {
            font-family: 'Roboto', sans-serif;
            color: #828282;
            margin: 0px;
            padding-bottom: 4rem;
        }

        nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        nav, {
            margin: 0 8px;
        }

        nav a, span {
            padding: 2px 11px;
            border-radius: 5px;
            border: 1px solid #F2F2F2;
            text-decoration: none;
            color: #828282;
        }

        .searchButtons > span:hover {
            background: #F2F2F2;
            cursor: pointer;
        }

        .grid {
            display: grid;
            max-width: 750px;
            grid-template-columns: 0.5fr 0.8fr 0.4fr;
            margin: auto;
        }

        .grid .btns {
            grid-column: 3;
        }

        .grid img {
            width: 100%;
            margin-top: auto;
        }

        .item {
            display: grid;
            grid-column: 1/-1;
            grid-template-columns: 0.5fr 0.8fr 0.4fr;
            border: 1px solid #E0E0E0;
            border-radius: 6px;
            margin-bottom: 6px;
        }

        .item .img {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 0 42px;
        }

        .item span {
            color: #333333;
            background: whitesmoke;
        }

        .img span {
            display: block;
            margin-top: 16px;
            color: #4F4F4F;
            margin-bottom: auto;
        }

        .details {
            padding: 0 33px;
            margin-top: -10px;
        }

        .details span {
            height: 36px;
            width: 24px;
            padding-top: 1px;
            display: inline-block;
            padding: 0 6px;
            margin-right: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .details span:hover {
            cursor: pointer;
        }

        .quantity, .sizes {
            display: flex;
            align-items: center;
        }

        .grandTotal {
            grid-column: 2;
            padding-right: 33px;
            display: flex;
            align-items: center;
        }

        .grandTotal > p {
            margin-left: auto;
        }

        .cost {
            position: relative;
            background: whitesmoke;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cost svg {
            position: absolute;
            right: 0;
            top: 0;
        }

        .cost h1, .grandTotalCost h1 {
            text-align: center;
            color: #Eb5757;
        }

        .item span.active {
            background: #Eb5757;
            color: white;
            border: 1px solid #333333;
            font-weight: bold;
        }

        .btns button {
            width: 100%;
            height: 44px;
            font-weight: bold;
            font-size: 15px;
            border-radius: 5px;
        }
        button.primary {
            background: #EB5757;
            color: white;
            border: 1px solid black;
            margin-bottom: 5px;
        }

        button.secondary {
            background: whitesmoke;
            color: #333333;
            border: 1px solid #E0E0E0;
        }
    </style>
</head>
<body>
    <nav>

        <p><img src="{{split0 data.resources.[0].logo}}" height="44"></p>

        <div>
            <a href="/{{data.brand}}/gen/page/aboutPage/n">Sign In</a>
            <a href="/{{data.brand}}/gen/page/cartPage/n">Cart</a>
        </div>
    
    </nav>
    <section class="grid">
    {{#each data}}
        <div class="item">

            <div class="img">
                <img src="{{split0 this.items.[0].imgURL}}" alt="">
                <span>Item details</span>
            </div>
            <div class="details">
                <h1>{{this.items.[0].name}}</h1>
                <p>{{this.items.[0].school}} Â· {{this.items.[0].category}}</p>
                <p>Quantity</p>
                <p class="quantity" id="quantity{{@index}}" quantity="{{this.quantity}}" max-quantity="{{this.items.[0].quantity}}">
                    <span onclick="minusOne('quantity{{@index}}')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 14H5V12H19V14Z" fill="#333333"/>
                    </svg>
                    </span>
                    <span class="active">{{this.quantity}}</span>
                    <span onclick="addOne('quantity{{@index}}')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 13H13V19H11V13H5V11H11V5H13V11H19V13Z" fill="#333333"/>
                    </svg>
                    </span>
                </p>
                <p>Size</p>
                <p class="sizes">
                    <span {{#if (matchValues this.items.[0].size 'S')}} class="active" {{/if}}>S</span>
                    <span {{#if (matchValues this.items.[0].size 'M')}} class="active" {{/if}}>M</span>
                    <span {{#if (matchValues this.items.[0].size 'L')}} class="active" {{/if}}>L</span>
                    <span {{#if (matchValues this.items.[0].size 'XL')}} class="active" {{/if}}>XL</span>
                </p>
            </div>
            <div class="cost" cost="{{this.items.[0].cost}}">
                <h1>PKR {{this.items.[0].cost}}</h1>
                <svg onclick="removeItem(this)" width="34" height="34" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0)">
                    <path d="M21.2133 14.1421L19.7991 12.7279L16.9707 15.5563L14.1423 12.7279L12.7281 14.1421L15.5565 16.9705L12.7281 19.7989L14.1423 21.2131L16.9707 18.3847L19.7991 21.2131L21.2133 19.7989L18.3849 16.9705L21.2133 14.1421ZM24.0418 9.89944C20.1385 5.99621 13.8029 5.99621 9.89964 9.89944C5.99641 13.8027 5.99641 20.1383 9.89964 24.0416C13.8029 27.9448 20.1385 27.9448 24.0418 24.0416C27.945 20.1383 27.945 13.8027 24.0418 9.89944ZM11.3138 22.6274C8.19551 19.509 8.19551 14.432 11.3138 11.3137C14.4322 8.19531 19.5092 8.19531 22.6276 11.3137C25.7459 14.432 25.7459 19.509 22.6276 22.6274C19.5092 25.7457 14.4322 25.7457 11.3138 22.6274Z" fill="#EB5757"/>
                    </g>
                    <defs>
                    <clipPath id="clip0">
                    <rect width="24" height="24" fill="white" transform="translate(16.9707) rotate(45)"/>
                    </clipPath>
                    </defs>
                </svg>
            </div>
        
        </div>
    {{/each}}
        <div class="grandTotal" style=""><p>Grand Total</p></div>
        <div class="grandTotalCost"><h1>PKR 3880</h1></div>
        <div class="btns">
            <button class="primary">Check Out</button>
            <button class="secondary">Continue Shopping</button>
        </div>
    </section>
    
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script>
        let addOne = function(elemId) {
            let elem = $(`#${elemId}`);
            let maxQty = elem.attr('max-quantity');
            let currentQty = Number( elem.attr('quantity') ) + 1 > maxQty ? maxQty : Number ( elem.attr('quantity') ) + 1;
            elem.attr('quantity',currentQty);
            elem.find('span.active').html(currentQty);
            // TODO: Show multiplied answer in the total field
            changeTotal(elemId);
            // TODO: Update Cart with new Quantity
        };

        let minusOne = function(elemId) {
            let elem = $(`#${elemId}`);
            let currentQty = elem.attr('quantity') - 1 < 1 ? 1 : elem.attr('quantity') - 1;
            elem.attr('quantity',currentQty);
            elem.find('span.active').html(currentQty);
            changeTotal(elemId);
        };

        let changeTotal = function(elemId) {
            let elem = $(`#${elemId}`);
            let currentQty = elem.attr('quantity');
            let itemCost = elem.closest('.item').find('.cost').attr('cost');
            let newCost = Number(currentQty) * Number(itemCost);
            elem
                .closest('.item')
                .find('.cost > h1')
                .html('PKR ' + newCost);
            changeGrandTotal();    
        }

        let changeGrandTotal = function() {
            let elems = $('.cost').get().map(val => $(val).find('h1').html().split(' ')[1]);
            let total = elems.reduce( (total, val) => total = total + Number(val), 0 );
            console.log(elems, total);
            $('.grandTotalCost')
                .find('h1')
                .html('PKR ' + total);
        }

        let toggleClass = function(elem) {
            $(this).parent('.sizes').find('span').removeClass('active');
            $(this).addClass('active');
        }

        let removeItem = function(elem) {
            $(elem).closest('.item').remove();
            changeGrandTotal();
        }

        $('.sizes > span').on('click',toggleClass);
        $(document).ready(changeGrandTotal);
    </script>
</body>
</html>
